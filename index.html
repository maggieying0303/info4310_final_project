<!DOCTYPE html>
<html lang = "en">
<head>
  <meta charset="UTF-8" />
  <link rel="shortcut icon" href="#"/>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script type="text/javascript" src="js/sliderVis.js"></script>
  <script type="text/javascript" src="js/yolkVis.js"></script>
  <script type="text/javascript" src="js/barChartVis.js"></script>
  <script type="text/javascript" src="js/doughnutVis.js"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="css/all.css" media="all" />

  <title>Final Project</title>
</head>

<body>

  <h1>streaming platforms for moviegoers</h1>
  <p>Prime video wins the number game.</p>
  <div style="margin: 0 auto; width: 1200px; text-align: center">
    <h2>
    <svg width="900" height="500" class="barchart"></svg>
    <img src="pics/mock1.png" style="width: 700px" alt="mock"/>
    <img src="pics/mock2.png" style="width: 700px" alt="mock"/>
    <br/>
    <br/>
    <h2>median movie ratings across platforms</h2>
    <p style="margin-right: 50px;">... however, quantity â‰  quality.</p>
  <div>
    <!-- <div style="width:1500px; display:flex; flex-direction:row; align-items:center;"> -->
    <svg width="700" height="700" class="yolk"/>
    <div style="margin-left: 0px" id="yolk_hover"></div>
    <!-- </div> -->
    <h2>movie top genres on streaming platforms</h2>
    <svg width="1000" height="550" class="doughnut">
  </div>
    <svg width="1200" height="700" class="budgetslider"/>
  <div>

  <!-- <div id="disney" style="width: 500px; height: 500px;"></div>
  <div id="hulu" style="width: 500px; height: 500px;"></div>
  <div id="netflix" style="width: 500px; height: 500px;"></div>
  <div id="prime" style="width: 500px; height: 500px;"></div>
  <svg width=800 height=600 id="genreChart" ></svg> -->

  <script>

  const requestData = async function() {

    //reading data
    const movies = await d3.csv("datasets/movies.csv");
    const movies_total = await d3.csv("datasets/total_number.csv");
    const movies_netflix = await d3.csv("datasets/movies_netflix.csv");
    const movies_hulu = await d3.csv("datasets/movies_hulu.csv");
    const movies_prime = await d3.csv("datasets/movies_prime.csv");
    const movies_disney = await d3.csv("datasets/movies_disney.csv");
    const top20_genres = await d3.csv("datasets/top20_genres.csv");
    const yolk = await d3.csv("datasets/median_ratings.csv");

    let topGenres = ['Drama','Comedy', 'Thriller', 'Action', 'Documentary', 'Family', 'Adventure', 'Fantasy'];
    let platforms = ["Netflix", "Hulu", "Prime", "Disney+"];
    // console.log(movies_netflix);
    // console.log(movies_hulu);
    // console.log(movies_prime);
    // console.log(movies_disney);
    // console.log(yolk);
    // console.log(movies)
    // console.log(top20_genres);

    // add slider vis
    drawBarChart(".barchart", topGenres, platforms, top20_genres);
    drawSliderVis(".budgetslider");
    drawYolkVis(".yolk", getYolkData(yolk), topGenres);
    drawDoughnutVis(".doughnut", topGenres, platforms, top20_genres);

    // density charts
    // const dict = {'Disney+':{'order':4, 'dataset':movies_disney, 'color':'#000000','id':'#disney'},
    // 'Hulu':{'order':2, 'dataset':movies_hulu, 'color':'#1CE783','id':'#hulu'},
    // 'Netflix':{'order':1, 'dataset':movies_netflix, 'color':'#E50914', 'id':'#netflix'},
    // 'Prime Video':{'order':3, 'dataset':movies_prime,'color':'#00A8E1','id':'#prime'},
    // };
    //
    // for (platform in dict) {
    //
    //   const container = d3.select(dict[platform]['id']).style("position","relative");
    //   const width = Number(container.style("width").replace("px",""));
    //   const height = Number(container.style("height").replace("px",""));
    //   const margin = { top: 10, right: 10, bottom: 50, left:50};
    //   const chartWidth = width - margin.left - margin.right;
    //   const chartHeight = height - margin.top - margin.bottom;
    //
    //   // Add a canvas element
    //   const canvas = container.append("canvas")
    //                           .attr("width",chartWidth)
    //                           .attr("height",chartHeight)
    //                           .style("position","absolute")
    //                           .style("top",margin.top + 'px')
    //                           .style("left",margin.left + 'px');
    //
    //   // Layer SVG on top of the canvas so we can draw axes and make the canvas interactive
    //   const svg = container.append("svg")
    //                        .attr("width", width)
    //                        .attr("height", height)
    //                        .style("position","absolute")
    //                        .style("top", 0)
    //                        .style("left", 0);
    //                        const interactiveArea = svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")");
    //
    //  interactiveArea.append("rect")
    //                 .attr("width",chartWidth)
    //                 .attr("height",chartHeight)
    //                 .attr("x",0)
    //                 .attr("y",0)
    //                 .attr("opacity",0);
    //
    //   indexMatrix = []
    //   for (let i=0; i<height; i++) {
    //     row = [];
    //     for (let j=0; j<width; j++) {
    //       row.push(-1);
    //     }
    //     indexMatrix.push(row);
    //   }
    //
    //   // draw
    //   const context = canvas.node().getContext('2d');
    //   context.clearRect(0, 0, width, height);
    //   context.globalAlpha = 0.6;
    //
    //   // console.log(dict[platform]['dataset']);
    //
    //   dict[platform]['dataset'].forEach( (d,i) => {
    //     let x = d3.randomNormal(margin.left, chartWidth)();
    //     let y = d3.randomNormal(margin.top, chartHeight)();
    //     let rad = 3;
    //     let color = "purple";
    //
    //     context.fillStyle = color;
    //     context.beginPath();
    //     context.arc(x, y, rad, 0, 2*Math.PI);
    //     context.fill();

      // Store the indices to make the canvas interactive
      // let radSq = rad * rad;
      // for (let mx=x-rad; mx<=x+rad; mx++) {
      //   for (let my=y-rad; my<=y+rad; my++) {
      //     distance = ((x - mx) * (x - mx)) + ((y - my) * (y - my));
      //     console.log(distance);
      //     if (distance <= radSq) {
      //         indexMatrix[parseInt(my)][parseInt(mx)] = i;
      //     }
      //  }
      // }

    // });

    // console.log(dict[platform]['dataset']);

  // }

  // const genreSVG = d3.select("svg#genreChart");
  // let genreMargin = { top: 10, right: 10, bottom: 50, left:50};
  // let genreWidth = genreSVG.attr("width") - genreMargin.left - genreMargin.right;
  // // console.log(genreWidth)
  // let genreHeight = genreSVG.attr("height") - genreMargin.top - genreMargin.bottom;
  // // console.log(genreHeight)
  //
  // let annotations = genreSVG.append("g").attr("id","annotations");
  // let chartArea = genreSVG.append("g").attr("id","points")
  //                 .attr("transform","translate("+genreMargin.left+","+genreMargin.top+")");
  //
  // disneyTotal = movies_disney.length;
  // netflixTotal = movies_netflix.length;
  // huluTotal = movies_hulu.length;
  // primeTotal = movies_prime.length;
  //
  // let providerList = ["Netflix", "Hulu", "Disney+", "Prime"]
  // let totalList = [disneyTotal, netflixTotal, huluTotal, primeTotal];
  //
  // let maxMovies = d3.max(totalList);
  //
  // let top5_genres = top20_genres.slice(0, 5);
  // // console.log(top5_genres[0]["Genre"]);
  //
  // let genreTitles = [];
  // for (i in top5_genres) {
  //   genreTitles.push(top5_genres[i]["Genre"]);
  // }
  // console.log(genreTitles);

  // Scales
  // const providerScale = d3.scaleBand()
  //                         .domain(providerList)
  //                         .range([0, genreWidth]);
  //
  // const genreScaleCategories = d3.scaleBand()
  //                      .domain(genreTitles)
  //                      .range([genreHeight, 0])
  //
  // const genreScale = d3.scaleLinear()
  //                      .domain([0, maxMovies])
  //                      .range([genreHeight, 0])

  // Axes
  // x axis
  // genreSVG.append("g")
  //         .attr("class", "x")
  //         .attr("transform","translate("+(genreMargin.left+50)+","+(genreHeight+genreMargin.top)+")")
  //         .call(d3.axisBottom(providerScale)
  //                 .tickSize(0))
  //         .selectAll("text")
  //         .attr("transform","translate("+0+","+genreMargin.top+")")
  //         .style("font-size", 14)

  // y axis
  // genreSVG.append("g")
  //         .attr("class", "y")
  //         .attr("transform","translate("+(genreMargin.left+50)+","+(genreMargin.top)+")")
  //         .call(d3.axisLeft(genreScaleCategories)
  //                 .tickSize(0))
  //         .selectAll("text")
  //         .attr("transform","translate("+(-genreMargin.right)+","+0+")")
  //         .style("font-size", 14)

  // color palette = one color per subgroup
  // const colorScale = d3.scaleOrdinal()
  //                      .domain(providerList)
  //                      .range(['#e50914','#3DBB3D','#113CCF','#00A8E1'])

  // Netflix movies
  // let netflix_genrecount = {}
  // for (i in movies_netflix) {
  //   console.log((movies_netflix[i]["Genres"]).split(","));
  // }


  //barchart!!!

  // let allLayer = d3.select("#bar_chart").append("g");
  // let allWidth = d3.select("#bar_chart").attr("width");
  // let allHeight = d3.select("#bar_chart").attr("height");
  // const scale_barchart = d3.scaleLinear().domain([0, movies_prime.length]).range([10, allWidth-10]);
  //
  //     const dict_bar = {'Netflix':{'order':1, 'dataset':movies_netflix, 'color':'#E50914'}, 'Hulu':{'order':2, 'dataset':movies_hulu, 'color':'#1CE783'}, 'Prime Video':{'order':3, 'dataset':movies_prime, 'color':'#00A8E1'}, 'Disney+':{'order':4, 'dataset':movies_disney, 'color':'#000000'}}
  //
  //     for (platform in dict_bar){
  //
  //       d3.select("#bar_chart")
  //         .append("rect")
  //         .attr("x", 0)
  //         .attr("y", (allHeight-100)/4*dict_bar[platform]['order'])
  //         .attr("width", scale_barchart(dict_bar[platform]['dataset'].length))
  //         .attr("height", 20)
  //         .attr("fill", dict_bar[platform]['color'])
  //         .attr("opacity", 0.7);
  //
  //       d3.select("#bar_chart")
  //         .append("text")
  //         .text(platform+": "+dict_bar[platform]['dataset'].length.toString())
  //         .attr("x", 0)
  //         .attr("y", (allHeight-100)/4*dict_bar[platform]['order']+40);
  //
  //     }

  }
  requestData();

  function getYolkData(yolk) {
    data = []

    yolk.forEach((d, i) => {
      let list = []

      for(key in d){
        let dict = {};
        dict['axis'] = key;
        dict['ratings'] = Math.round(d[key] * 100) / 100;
        list.push(dict);
      }

      list.shift();
      data.push(list);

    });
    return data;
  }

  </script>

</body>
</html>
